# Email Validation Service Configuration

# Server Configuration
server:
  port: 8080
  host: 0.0.0.0
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 60s
  shutdown_timeout: 30s

# SMTP Verification Configuration
smtp:
  # Connection Timeouts
  connect_timeout: 10s
  read_timeout: 15s
  write_timeout: 15s
  
  # SMTP Identity
  ehlo_hostname: mail-validator.yourdomain.com
  mail_from: verify@mail-validator.yourdomain.com
  
  # Retry Policy
  max_retries: 3
  retry_backoff: 2s
  retry_backoff_factor: 2.0
  
  # Catch-all Detection
  enable_catch_all_detection: true
  catch_all_probe_count: 2
  catch_all_cache_ttl: 168h # 7 days

# Worker Pool Configuration
workers:
  # Pool Sizes
  pool_size: 1000
  min_workers: 10
  max_workers: 5000
  
  # Concurrency Limits
  max_concurrent_per_domain: 5
  max_concurrent_per_mx: 50
  
  # Rate Limiting
  domain_rate_limit: 1s  # Min delay between requests to same domain
  mx_rate_limit: 100ms   # Min delay between requests to same MX

# Queue Configuration
queue:
  # Redis Streams
  stream_name_express: queue:validation:express
  stream_name_standard: queue:validation:standard
  stream_name_bulk: queue:validation:bulk
  stream_dlq: queue:validation:dlq
  
  # Consumer Configuration
  consumer_group: validators
  consumer_count: 10
  batch_size: 100
  block_time: 5s
  
  # Dead Letter Queue
  max_delivery_attempts: 3
  dlq_retention: 168h # 7 days

# Redis Configuration
redis:
  # Connection
  host: localhost
  port: 6379
  password: ""
  db: 0
  
  # Pool
  max_idle_conns: 50
  max_active_conns: 200
  conn_max_lifetime: 5m
  
  # Cache TTLs
  mx_cache_ttl: 1h
  mx_cache_ttl_max: 24h
  result_cache_ttl: 168h # 7 days
  domain_meta_cache_ttl: 24h
  
  # Timeouts
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

# PostgreSQL Configuration
database:
  # Connection
  host: localhost
  port: 5432
  user: email_validator_app
  password: CHANGE_ME_IN_PRODUCTION
  database: email_validation
  sslmode: require
  
  # Pool
  max_open_conns: 100
  max_idle_conns: 10
  conn_max_lifetime: 1h
  conn_max_idle_time: 10m
  
  # Batch Operations
  batch_insert_size: 1000
  batch_insert_interval: 5s
  
  # Timeouts
  connect_timeout: 10s
  statement_timeout: 30s

# API Configuration
api:
  # Rate Limiting (per customer)
  rate_limit_free: 100/hour
  rate_limit_standard: 10000/hour
  rate_limit_enterprise: unlimited
  
  # Request Limits
  max_batch_size: 100000
  max_request_size: 10MB
  
  # Pagination
  default_page_size: 1000
  max_page_size: 10000

# Authentication
auth:
  # API Keys
  api_key_header: X-API-Key
  api_key_required: true
  
  # JWT (optional)
  jwt_secret: CHANGE_ME_IN_PRODUCTION
  jwt_expiration: 24h

# Logging
logging:
  level: info  # debug, info, warn, error
  format: json # json or text
  output: stdout
  
  # Log Sampling (reduce volume in production)
  sample_rate: 1.0  # 1.0 = all logs, 0.1 = 10% sample
  
  # Structured Fields
  include_caller: false
  include_stacktrace: false

# Metrics and Observability
metrics:
  # Prometheus
  enabled: true
  port: 9090
  path: /metrics
  
  # Histogram Buckets (in seconds)
  latency_buckets: [0.1, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0]
  
  # Custom Metrics
  track_domain_stats: true
  track_mx_stats: true

# Tracing
tracing:
  enabled: false
  provider: jaeger # jaeger, zipkin, otlp
  endpoint: http://localhost:14268/api/traces
  sample_rate: 0.1  # 10% of requests

# Health Checks
health:
  enabled: true
  port: 8081
  path: /health
  
  # Check Intervals
  database_check_interval: 30s
  redis_check_interval: 30s
  queue_check_interval: 30s

# Security
security:
  # Egress IPs (for SMTP connections)
  egress_ips:
    - 192.0.2.1
    - 192.0.2.2
  
  # Network
  allow_private_ips: false
  allow_localhost: false
  
  # Data Privacy
  hash_emails_in_logs: true
  pii_retention_days: 90

# Feature Flags
features:
  enable_batch_validation: true
  enable_webhook_callbacks: true
  enable_csv_export: true
  enable_cache_warming: true
  enable_auto_scaling: true

# Performance Tuning
performance:
  # DNS Caching
  dns_cache_size: 10000
  dns_cache_ttl: 1h
  
  # Connection Pools
  enable_connection_pooling: true
  pool_cleanup_interval: 1m
  
  # Batch Processing
  enable_domain_grouping: true
  domain_batch_size: 100

# Disposable Domain Detection
disposable_domains:
  # Built-in List
  enable_builtin_list: true
  
  # External List (optional)
  external_list_url: ""
  external_list_refresh_interval: 24h
  
  # Custom Additions
  custom_disposable_domains:
    - tempmail.com
    - guerrillamail.com
    - 10minutemail.com

# Alerting
alerting:
  enabled: true
  
  # Channels
  slack_webhook: ""
  pagerduty_key: ""
  email_recipients: []
  
  # Alert Rules
  high_error_rate_threshold: 0.05    # 5%
  high_latency_p95_threshold: 5s
  queue_depth_threshold: 10000
  cache_hit_rate_threshold: 0.5      # 50%
  worker_utilization_threshold: 0.9  # 90%

# Data Retention
retention:
  # Validation Results
  validation_results_retention_days: 90
  
  # Jobs
  completed_jobs_retention_days: 30
  failed_jobs_retention_days: 60
  
  # Logs
  application_logs_retention_days: 30
  audit_logs_retention_days: 365
  
  # Cache
  redis_eviction_policy: allkeys-lru

# Development/Testing
development:
  enable_debug_endpoints: false
  enable_mock_smtp: false
  mock_smtp_response_code: 250
  seed_test_data: false

# Environment-specific overrides
# These can be set via environment variables with prefix EMAIL_VALIDATOR_
# Example: EMAIL_VALIDATOR_SERVER_PORT=9000
